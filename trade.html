<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VET DAO - 거래 상세</title>

  <!-- 공용 head(스타일/파비콘/폰트 등) -->
  <script>
    // head partial 로드
    fetch("/partials/head.html")
      .then(r => r.text())
      .then(html => document.head.insertAdjacentHTML("beforeend", html))
      .catch(() => {});
  </script>
</head>

<body class="dark">
  <div id="site-header"></div>

  <main class="site-main">
    <div class="container">
      <section class="panel">
        <div class="panel-top">
          <div>
            <h1 class="title">거래 상세</h1>
            <div class="muted" id="subTitle">-</div>
          </div>

          <div class="actions">
            <button class="btn" id="btnConnect">지갑 연결</button>
          </div>
        </div>

        <div class="walletbar">
          <div class="pill">지갑: <span id="walletAddr">미연결</span></div>
          <div class="pill">HEX: <span id="myHexBal">-</span></div>
          <div class="pill">USDT: <span id="myUsdtBal">-</span></div>
          <div class="pill">VET: <span id="myVetBal">-</span></div>

        </div>

        <div id="note" class="note" style="display:none;"></div>

        <div class="hr"></div>

        <div class="grid">
          <div class="kv">
            <div class="k">토큰</div>
            <div class="v" id="vToken">-</div>
          </div>
          <div class="kv">
            <div class="k">수량</div>
            <div class="v" id="vAmount">-</div>
          </div>

          <div class="kv">
            <div class="k">결제통화</div>
            <div class="v" id="vFiat">-</div>
          </div>
          <div class="kv">
            <div class="k">총 결제금액(메타)</div>
            <div class="v" id="vFiatAmount">-</div>
          </div>

          <div class="kv">
            <div class="k">상태</div>
            <div class="v" id="vStatus">-</div>
          </div>
          <div class="kv">
            <div class="k">paymentRef</div>
            <div class="v mono" id="vPaymentRef">-</div>
          </div>

          <div class="kv">
            <div class="k">판매자</div>
            <div class="v mono" id="vSeller">-</div>
          </div>
          <div class="kv">
            <div class="k">구매자</div>
            <div class="v mono" id="vBuyer">-</div>
          </div>

          <div class="kv">
            <div class="k">seller SNS</div>
            <div class="v" id="vSellerSns">-</div>
          </div>
          <div class="kv">
            <div class="k">VET 보상</div>
            <div class="v" id="vVetBadge">-</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="panel2">
          <h2 class="h2">거래 진행</h2>

          <div class="steps">
            <div class="step">
              <div class="step-title">1) 구매자: 거래 수락</div>
              <div class="muted">리스트 보고 거래를 선택한 뒤 판매자 sns확인 후 거래수락을 합니다.</div>
              <button class="btn" id="btnAccept">거래수락</button>
            </div>

            <div class="step">
              <div class="step-title">2) 구매자: 오프체인 송금 완료 표시</div>
              <div class="muted">구매자가 판매자 계좌로 KRW/VND를 입금 후 입금완료를 기록 합니다</div>
              <div class="row">
                <input class="input mono" id="inpRef" placeholder="송금 식별자(선택) 예: honggildong-1200-krw" />
                <button class="btn" id="btnPaid">입금 완료</button>
              </div>
            </div>

            <div class="step">
              <div class="step-title">3) 판매자: 입금 확인 후 토큰 이체 </div>
              <div class="muted">판매자가 계좌 입금확인 후 토큰이체를 신청 → 계약이 가지고 있는 토큰이 구매자에게 전송됩니다. (HEX 거래면 VET보상 로직 수행)</div>
              <button class="btn primary" id="btnRelease">토큰이체</button>
            </div>

            <div class="step">
              <div class="step-title">4) 판매자: 거래 취소(조건 충족 시)</div>
              <div class="muted">OPEN/TAKEN에서 cancelGraceSeconds 조건 충족 등 컨트랙트 조건에 따라 취소 가능</div>
              <button class="btn danger" id="btnCancel">cancelBySeller</button>
            </div>
          </div>
        </div>

      </section>
    </div>
  </main>

  <div id="site-footer"></div>

  <!-- partials/header/footer 로드 -->
<script src="https://cdn.jsdelivr.net/npm/ethers@6.14.0/dist/ethers.umd.min.js"></script>
<script src="/assets/js/config.js"></script>
<script src="/assets/js/contract.js"></script>
<script type="module" src="/assets/js/firebase.js"></script>
<script src="/assets/js/partials.js"></script>

<script type="module">
  // header/footer 주입 완료까지 보장
  await window.loadPartials();
  // 그 다음에 지갑 기능 로드
  await import("/assets/js/header-wallet.js");
</script>

<script type="module" src="/assets/js/pages/trade.js"></script>

</body>
</html>
